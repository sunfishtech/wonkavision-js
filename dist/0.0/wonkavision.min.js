/*  wonkavision.js, version 0.0.1

Copyright (c) 2011 [your name here]

Permission is hereby granted, free of charge, to any person
obtaining a copy of this software and associated documentation
files (the "Software"), to deal in the Software without
restriction, including without limitation the rights to use,
copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the
Software is furnished to do so, subject to the following
conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
OTHER DEALINGS IN THE SOFTWARE.
------------------------------------------------------------------*/
(function(){var d=function(){},c=function(a){null==a&&(a={});this.url=a.url||"";this.facts={};this.aggregations={}};c.prototype.query=function(a){null==a&&(a={});return new d.Query(this,a)};c.prototype.execute=function(a,b){var e,j;j=b.raw;e=b.error||function(){};this.get("query",a.toParams(),function(e){e=j?e:new d.Cellset(e.json,a);null!=e.error&&b.error(repsonse);return b.success(e)},e);return this};c.prototype.get=function(a,b,e,j){var c;c=this.url+("/"===this.url.substr(-1)?"":"/");return d.Remote.get(c+
a,{data:b,success:e,error:j})};d.Client=c;this.Wonkavision=d;this.Wonkavision.AXIS_NAMES=["columns","rows","pages","chapters","sections"]}).call(this);
(function(){var d=this.Wonkavision,c=function(){};c.prototype.xhr=function(a){a=this.createSettings(a.url,a);a.ajax=a.xhr();if(a.ajax)return this.prepareUrl(a),a.ajax.open(a.type,a.url,a.async),a.ajax.send(a.data||null),this.httpData(a)};c.prototype.prepareUrl=function(a){if("GET"===a.type&&a.data)return a.url+=/\?/.test(a.url)?"&":"?",a.url+=this.toParams(a.data),a.data=null};c.prototype.createSettings=function(a,b){null==b&&(b={});return{url:a,data:b.data||"",success:b.success||function(){},error:b.error||
function(){},type:b.type||"GET",async:b.async||!0,xhr:function(){return new window.XMLHttpRequest}}};c.prototype.toParams=function(a){var b,e,j;null==a&&(a={});e=[];for(b in a)j=a[b],e.push(""+b+"="+j);return encodeURI(e.join("&"))};c.prototype.httpData=function(a){return a.ajax.onreadystatechange=function(){var b;if(4===a.ajax.readyState){try{b=JSON.parse(a.ajax.responseText)}catch(e){console.log("Could not parse response ("+a.ajax.responseText+") as JSON:"+e)}b={xml:a.ajax.responseXML,text:a.ajax.responseText,
json:b};/(2..)/.test(a.ajax.status)?a.success.call(a.ajax,b):(console.log("There was an error processing a Wonkavision data request:"+a.ajax.statusText),a.error&&a.error.call(null,a.ajax.statusText));return b}return null}};d.Remote=c;this.Wonkavision.Remote.ajax=function(a){return(new c).xhr(a)};this.Wonkavision.Remote.get=function(a,b){b.url=a;return(new c).xhr(b)};this.Wonkavision.Remote.post=function(a,b){b.url=a;b.type="POST";return(new c).xhr()}}).call(this);
(function(){var d=this.Wonkavision,c=function(a,b){this.name=a;null==b&&(b={});this.operator=b.operator||"eq";this.memberType=b.memberType||"dimension";this.value=b.value;this.attributeName=b.attributeName||(this.isDimension?"key":"count");this.operators="eq ne gt gte lt lte in nin".split(" ")};c.prototype.isDimension=function(){return"dimension"===this.memberType};c.prototype.isMeasure=function(){return"measure"===this.memberType};c.prototype.toString=function(){return[this.memberType,this.name,
this.attributeName,this.operator,this.value.toString()].join("::")};c.prototype.parse=function(a,b){var e;null==b&&(b="::");e=a.split(b);if("dimension"===e[0]||"measure"===e[0]||"fact"===e[0])this.memberType=e.shift();this.name=e.shift();this.attributeName=e.shift()||this.attributeName;this.operator=e.shift()||this.operator;this.value=e.shift()||this.value;return this};c.prototype.withValue=function(a){this.value=a;return this};d.Filter=c;this.Wonkavision.Filter.parse=function(a,b){null==b&&(b="::");
return(new c("")).parse(a,b)}}).call(this);
(function(){var d,c=[].slice;d=this.Wonkavision.Filter;var a=this.Wonkavision,b=function(a,b){var c,f,g,d;this.client=a;null==b&&(b={});d=Wonkavision.AXIS_NAMES;f=0;for(g=d.length;f<g;f++)c=d[f],this[c]=this.select(c);this.listDelimiter=b.listDelimiter||"|";this.axes=[];this.filters=[];this.selectedMeasures=[];d=Wonkavision.AXIS_NAMES;f=0;for(g=d.length;f<g;f++)if(c=d[f],null!=b[c])this[c](b[c]);null!=b.measures&&this.measures(b.measures);null!=b.where&&this.where(b.where);null!=b.from&&this.from(b.from)};
b.prototype.cube=function(a){this.cubeName=a;return this};b.prototype.from=function(a){this.cubeName=a;return this};b.prototype.measures=function(){var a;a=1<=arguments.length?c.call(arguments,0):[];this.selectedMeasures=this.selectedMeasures.concat(_.flatten(a));return this};b.prototype.where=function(a){var b,c;null==a&&(a={});this.filters=this.filters.concat(function(){var f;f=[];for(b in a)c=a[b],f.push(d.parse(b,".").withValue(c));return f}());return this};b.prototype.toParams=function(){var a,
b,c,f,g;b={from:this.cubeName};1>this.selectedMeasures.length||(b.measures=this.selectedMeasures.join(this.listDelimiter));if(!(1>this.filters.length)){c=this.listDelimiter;var d,h;d=this.filters;h=[];f=0;for(g=d.length;f<g;f++)a=d[f],h.push(a.toString());b.filters=h.join(c)}g=Wonkavision.AXIS_NAMES;c=0;for(f=g.length;c<f;c++)a=g[c],this.getAxis(a)&&(b[a]=this.getAxis(a).join(this.listDelimiter));b.from=this.cubeName;return b};b.prototype.toString=function(){return toHash().toString()};b.prototype.execute=
function(a){null==a&&(a={});return this.client.execute(this,a)};b.prototype.getAxis=function(a){return this.axes[Wonkavision.AXIS_NAMES.indexOf(a)]};b.prototype.select=function(a){var b=this;return function(){var d,f;d=1<=arguments.length?c.call(arguments,0):[];f=Wonkavision.AXIS_NAMES.indexOf(a);0<=f&&(b.axes.length>f&&(d=b.axes[f].concat(d)),b.axes[f]=_.flatten(d));return b}};a.Query=b}).call(this);
(function(){var d,c;c=this.Wonkavision.Query;d=this.Wonkavision.Client;var a=this.Wonkavision,b=function(a){null==a&&(a={});this.serverUrl=a.url||a.serverUrl||"";this.client=a.client||new d(this.serverUrl);this.queries=[];this.global=new c};b.prototype.addQuery=function(a){null==a&&(a={});this.client.query(a);return this.queries.push(this.client.query(a))};a.QuerySet=b}).call(this);
(function(){var d,c,a,b,e=[].slice,j={}.hasOwnProperty,l=function(a,b){function c(){this.constructor=a}for(var e in b)j.call(b,e)&&(a[e]=b[e]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a};b=this.Wonkavision;var f=function(a,b){var c,e,j,d,g,h,l,k,u,v=this;this.cellset=a;null==b&&(b={});_.bindAll(this,"cellValues","cellValue");this.axes=_.map(this.cellset.axes,function(a){return v[a.name]=new f.Axis(a.name,a.dimensions.slice(0),v)});(this.measuresAxis=b.measuresAxis||
b.measuresOn)||(this.measuresAxis=this.isFlat?"rows":"columns");this.initializeAxes();this.seriesCells={};this.isFlat=2>this.axes.length?!0:!1;l=this.cellset.cells;for(j in l){e=l[j];k=this.axes;g=0;for(h=k.length;g<h;g++)c=k[g],c.registerCell(e);null!=this.seriesDimension&&(c=e.key[this.seriesDimension.keyIndex],c=(d=this.seriesCells)[c]||(d[c]=[]),c.push(e))}null!=this.measuresAxis&&null!=(u=this[this.measuresAxis])&&u.appendMeasures()};f.prototype.initializeAxes=function(){var a,b,c,e,f;e=this.axes;
f=[];b=0;for(c=e.length;b<c;b++)a=e[b],f.push(a.initialize());return f};f.prototype.pivot=function(){var a;a=this.rows;this.rows=this.columns;return this.columns=a};f.prototype.cellValues=function(a){var b,c=this;b=_.isArray(a)?_.last(a):a;return this.isFlat&&"rows"===this.measuresAxis?this.extractMeasures([b]):this.columns&&!this.columns.isEmpty?_.map(this.columns.members.nonEmpty().leaves(),function(a){return c.cellValue(b,a)}):[this.cellValue(b)]};f.prototype.cellValue=function(){var a;a=1<=arguments.length?
e.call(arguments,0):[];return this.extractValue(a)};f.prototype.extractValue=function(a,b){var c;c=_.flatten(_.map(_.sortBy(_.compact(a),function(a){return a.keyIndex}),function(a){return a.cellKey()}));c=this.cellset.cells[c];if(null!=c)return b=b||this.findMeasureName(a)||this.cellset.measureNames[0],c[b].value};f.prototype.extractMeasures=function(a,b){var c,e;null==b&&(b=!0);e=_.flatten(_.map(_.sortBy(_.compact(a),function(a){return a.keyIndex}),function(a){return a.cellKey()}));c=this.cellset.cells[e];
return _.map(this.cellset.measureNames,function(a){if(null!=c)return b?c[a].formattedValue:c[a].value})};f.prototype.findMeasureName=function(a){var b;return null!=(b=_.find(a,function(a){return null!=(null!=a?a.measureName:void 0)}))?b.measureName:void 0};b.PivotTable=b=f;var g=this.Wonkavision,k=function(a,b){null==b&&(b={});_.bindAll(this,"cellValues","cellValue");this.seriesSource=b.seriesSource||b.seriesFrom||(1<a.measureNames.length?"measures":"rows");k.__super__.constructor.call(this,a,b)};
l(k,b);k.prototype.initializeAxes=function(){this.xAxisDimension=this.columns.dimensions.pop();this.seriesDimension="measures"!==this.seriesSource&&null!=this[this.seriesSource]?this[this.seriesSource].dimensions.pop():void 0;"measures"===this.seriesSource&&(this.measuresAxis=null);return k.__super__.initializeAxes.call(this)};k.prototype.cellValue=function(){var a,b,c=this;a=1<=arguments.length?e.call(arguments,0):[];if("measures"===this.seriesSource)return _.map(this.cellset.measureNames,function(b){return{name:b,
data:c.seriesFromMeasure(a,b)}});if(null!=this.seriesDimension)return b=_.filter(this.seriesDimension.members,function(a){return null!=c.seriesCells[a.key]}),_.map(b,function(b){return{name:b.caption,data:c.seriesFromMember(a,b)}})};k.prototype.seriesFromMeasure=function(a,b){var e=this;return _.map(this.xAxisDimension.members,function(f){var j;j=c.fromDimensionMember(f);j=new d(b,j);j=a.concat([j]);return{x:f.key,y:e.extractValue(j,b)}})};k.prototype.seriesFromMember=function(a,b){var e,f=this;e=
c.fromDimensionMember(b);return _.map(this.xAxisDimension.members,function(b){var j;j=c.fromDimensionMember(b);j=a.concat([e,j]);return{x:b.key,y:f.extractValue(j)}})};g.ChartTable=k;b=this.Wonkavision.PivotTable;g=function(b,c,e){this.name=b;this.dimensions=c;this.pivotTable=e;this.members=new a};g.prototype.initialize=function(){if(!(this.isEmpty=1>this.dimensions.length))return this.startIndex=this.dimensions[0].keyIndex,this.endIndex=this.startIndex+this.dimensions.length-1,this.initLevels()};
g.prototype.initLevels=function(a,b){var e,f,j,g,d,h,l;null==a&&(a=[]);null==b&&(b=this);f=a.length;if(f<this.dimensions.length){h=this.dimensions[f].members;l=[];g=0;for(d=h.length;g<d;g++)j=h[g],j.isEmpty=!0,e=a.slice(0),e.push(j.key),j=b.members.push(new c(e,b,f+this.startIndex,j)),l.push(this.initLevels(e,j));return l}};g.prototype.registerCell=function(a){var b;if(!a.empty&&!(this.isEmpty||a.key.length<=this.startIndex))if(b=a.key.slice(this.startIndex,+this.startIndex+1||9E9),b=this.members.get(b))return b.registerCell(a)};
g.prototype.appendMeasures=function(){return this.members.appendMeasures(this.pivotTable.cellset)};b.Axis=g;b=this.Wonkavision.PivotTable;g=function(b,c,e,j){var f;this.key=b;this.parent=c;this.keyIndex=e;this.member=j;this.axis=null!=(null!=(f=this.parent)?f.axis:void 0)?this.parent.axis:this.parent;this.caption=this.member.caption;this.depth=this.axis?this.keyIndex-this.axis.startIndex:0;this.isEmpty=!0;this.isLeaf=this.axis?this.keyIndex===this.axis.endIndex:0;this.isLeaf||(this.members=new a)};
g.prototype.cellKey=function(){return this.key};g.prototype.leaves=function(a){null==a&&(a=!1);return this.isLeaf?[this]:this.members.leaves(a)};g.prototype.registerCell=function(a){var b;this.isEmpty=!1;this.member.isEmpty=!1;if(!this.isLeaf&&(b=this.keyIndex+1,b=a.key.slice(this.axis.startIndex,+b+1||9E9),b=this.members.get(b)))return b.registerCell(a)};b.Member=c=g;this.Wonkavision.PivotTable.Member.fromDimensionMember=function(a){return new c([a.key],null,a.dimension.keyIndex,a)};b=this.Wonkavision.PivotTable;
g=function(a,b){this.measureName=a;this.key=b.key.concat(["@"+a]);this.parent=b;this.axis=b.axis;this.caption=a;this.depth=b.depth+1;this.isEmpty=b.isEmpty;this.isLeaf=!0;b.isLeaf=!1;this.isMeasure=!0;this.keyIndex=b.keyIndex};l(g,c);g.prototype.cellKey=function(){return this.key.slice(0,-1)};b.MeasureMember=d=g;var l=this.Wonkavision.PivotTable,h=function(a,b){var c=this;null==a&&(a=[]);this.isNonEmpty=null!=b?b:!1;this.members=[];this.length=0;_.each(a,function(a){return c.push(a)})};h.prototype.get=
function(a){return _.find(this.members,function(b){return b.key.toString()===a.toString()})};h.prototype.push=function(a){this.invalidateCache();this.length+=1;this.members.push(a);return a};h.prototype.each=function(a){return _.each(this.members,a)};h.prototype.map=function(a){return _.each(this.members,a)};h.prototype.nonEmpty=function(){return new h(_.filter(this.members,function(a){return!a.isEmpty}),!0)};h.prototype.leaves=function(a){var b;null==a&&(a=this.isNonEmpty);null==this.leafCache&&
(b=a?this.nonEmpty().members:this.members,this.leafCache=_.flatten(_.map(b,function(b){return b.leaves(a)})));return this.leafCache};h.prototype.at=function(a){return this.members[a]};h.prototype.toArray=function(){return this.members};h.prototype.flatten=function(a,b){null==b&&(b=[]);null==a&&(a=this.isNonEmpty);this.map(function(c){if(!a||!c.isEmpty)if(b.push(c),!c.isLeaf)return c.members.flatten(a,b)});return b};h.prototype.partitionH=function(a){null==a&&(a=this.isNonEmpty);a=this.flatten(a);
return _.reduce(a,function(a,b){var c,e;c=_.last(a);(e=_.last(c))&&e.depth>=b.depth?a.push([b]):c.push(b);return a},[[]])};h.prototype.partitionV=function(a){null==a&&(a=this.isNonEmpty);a=this.flatten(a);return _.reduce(a,function(a,b){var c;(a[c=b.depth]||(a[c]=[])).push(b);return a},[])};h.prototype.appendMeasures=function(a){var b;b=a.measureNames;a=this.leaves();_.each(a,function(a){return a.members=new h(_.map(b,function(b){return new d(b,a)}))});return this.invalidateCache(!0)};h.prototype.invalidateCache=
function(a){null==a&&(a=!1);this.leafCache=null;if(a)return this.each(function(a){if(null!=a.members)return a.members.invalidateCache()})};l.MemberCollection=a=h}).call(this);(function(){var d=this.Wonkavision,c=function(a,b){this.dimension=a;this.key=b.key;this.caption=b.caption||this.key;this.sort=b.sort||this.key;this.attributes=b.attributes||{}};c.prototype.toString=function(){return key.toString()};c.prototype.toKey=function(){return key};d.Member=c}).call(this);
(function(){var d;d=this.Wonkavision.Member;this.Wonkavision.Dimension=function(c,a,b){var e=this;this.axis=c;this.keyIndex=b;this.name=a.name;this.members=_.sortBy(_.map(a.members,function(a){return new d(e,a)}),function(a){return a.sort})}}).call(this);
(function(){var d;d=this.Wonkavision.Dimension;this.Wonkavision.Axis=function(c,a,b,e){var j;this.name=c;this.cellset=a;this.startIndex=e;this.dimensions=[];this.dimensionNames=[];j=b.dimensions;a=b=0;for(e=j.length;b<e;a=++b)c=j[a],this.dimensions.push(new d(this,c,this.startIndex+a)),this.dimensionNames.push(c.name);this.endIndex=this.startIndex+this.dimensions.length-1}}).call(this);
(function(){var d=this.Wonkavision,c=function(a){var b;this.name=a.name;null!=a.value&&(this.value=parseFloat(a.value));this.formattedValue=a.formatted_value||(null!=(b=this.value)?b.toString():void 0);this.calculated=a.calculated||!1;this.empty=!this.value};c.prototype.toString=function(){return this.formatted_value};d.Measure=c}).call(this);
(function(){var d;d=this.Wonkavision.Measure;var c=this.Wonkavision,a=function(a,c){var j,d,f,g;this.cellset=a;this.measures={};this.empty=!0;if(c){g=c.measures;d=0;for(f=g.length;d<f;d++)j=g[d],this.addMeasure(j);this.key=c.key}};a.prototype.addMeasure=function(a){var c;c=a.name;this[c]=new d(a);this.measures[c]=this[c];if(!this[c].empty)return this.empty=!1};c.Cell=a}).call(this);
(function(){var d,c,a;c=this.Wonkavision.Cell;d=this.Wonkavision.Axis;a=this.Wonkavision.Filter;var b=this.Wonkavision,e=function(b,e){var f,g,k,h,m,n;null==b&&(b={});this.query=null!=e?e:null;this.cube=b.cube||null;h=b.slicer||[];g=b.filters||[];k=[];m=0;for(n=h.length;m<n;m++)f=h[m],k.push(a.parse(f));this.slicer=k;n=[];h=0;for(m=g.length;h<m;h++)f=g[h],n.push(a.parse(f));this.filters=n;this.totals=new c(this,b.totals);this.measureNames=b.measure_names||[];g=0;n=[];k=h=0;for(m=b.axes.length;0<=
m?h<m:h>m;k=0<=m?++h:--h)f=b.axes[k],k=Wonkavision.AXIS_NAMES[k],f=new d(k,this,f,g),g=f.endIndex+1,n.push(f);this.axes=n;this.cells={};m=b.cells||[];g=0;for(h=m.length;g<h;g++)f=m[g],this.cells[f.key]=new c(this,f);n=Wonkavision.AXIS_NAMES;g=h=0;for(m=n.length;h<m;g=++h)f=n[g],this[f]=this.axes[g]};e.prototype.cell=function(){var a,b;b=function(){var b,c,e;if("undefined"!==typeof a&&null!==a)return a.toString();e=[];b=0;for(c=arguments.length;b<c;b++)a=arguments[b],e.push(a);return e}.apply(this,
arguments);return this.cells[b]||new c(this)};b.Cellset=e}).call(this);
(function(){var d,c=function(a,b){this.view=a;this.extractArgs(b);this.palette=new Rickshaw.Color.Palette({scheme:this.colorScheme})};c.prototype.renderGraph=function(a,b){var c,d,l,f=this;d=_.map(a,function(a){return{name:a.name,color:f.colorFor(a.name),data:_.map(a.data,function(a){return{x:f.keyToDate(a.x),y:parseFloat(a.y)||0}})}});c=b.append("div").attr("class","wv-chart");l=b.append("div").attr("class","wv-y-axis");c=new Rickshaw.Graph(_.extend(this.graphArgs,{element:c[0][0],series:d}));new Rickshaw.Graph.Axis.Time(_.extend(this.xAxisArgs,
{graph:c}));new Rickshaw.Graph.Axis.Y(_.extend(this.yAxisArgs,{graph:c,element:l[0][0]}));new Rickshaw.Graph.HoverDetail(_.extend(this.hoverArgs,{graph:c}));return c.render()};c.prototype.colorFor=function(a){var b;this.colorCache||(this.colorCache={});return(b=this.colorCache)[a]||(b[a]=this.palette.color())};c.prototype.extractArgs=function(a){this.colorScheme=a.palette||a.colorScheme||this.colorScheme||"munin";this.graphArgs=_.defaults(a.graph||{},{width:300,height:300,renderer:"line"});this.xAxisArgs=
a.xAxis||{};this.yAxisArgs=_.defaults(a.yAxis||{},{orientation:"left",tickFormat:Rickshaw.Fixtures.Number.formatKMBT});return this.hoverArgs=a.hover||{}};c.prototype.keyToDate=function(a){a=""+a.slice(0,4)+"-"+a.slice(4,6)+"-"+a.slice(6,8);return moment(a).unix()};(d=this.Wonkavision).renderers||(d.renderers={});this.Wonkavision.renderers.Rickshaw=c}).call(this);
(function(){var d,c=function(a,b){this.view=a;this.extractArgs(b)};c.prototype.renderGraph=function(a,b){var c,d,l=this;d=_.map(a,function(a){return{name:a.name,data:_.map(a.data,function(a){return[l.keyToDate(a.x),parseFloat(a.y)||0]})}});c=b.append("div").attr("class","wv-chart");c=_.extend(this.chartArgs,{series:d,chart:_.extend(this.chartArgs.chart,{renderTo:c[0][0]})});return new Highcharts.Chart(c)};c.prototype.extractArgs=function(a){var b,c,d,l,f,g,k,h,m,n,p,q,r,s,t;this.chartArgs=a.highchart||
{};this.chartArgs.chart=_.defaults(this.chartArgs.chart||{},{borderColor:"#CCC",type:"line",backgroundColor:"white",spacingBottom:10,spacingTop:10});this.chartArgs.tooltip=_.defaults(this.chartArgs.tooltip||{},{shared:!0});this.chartArgs.plotOptions=_.extend(this.chartArgs.plotOptions||{},{series:_.defaults((null!=(b=this.chartArgs.plotOptions)?b.series:void 0)||{},{animation:!1}),line:_.defaults((null!=(c=this.chartArgs.plotOptions)?c.line:void 0)||{},{marker:_.defaults((null!=(h=this.chartArgs.plotOptions)?
null!=(m=h.line)?m.marker:void 0:void 0)||{},{enabled:!1}),shadow:!1}),column:_.defaults((null!=(n=this.chartArgs.plotOptions)?n.column:void 0)||{},{shadow:!1}),bar:_.defaults((null!=(p=this.chartArgs.plotOptions)?p.bar:void 0)||{},{shadow:!1}),spline:_.defaults((null!=(q=this.chartArgs.plotOptions)?q.spline:void 0)||{},{marker:_.defaults((null!=(r=this.chartArgs.plotOptions)?null!=(s=r.spline)?s.marker:void 0:void 0)||{},{enabled:!1}),shadow:!1}),area:_.defaults((null!=(t=this.chartArgs.plotOptions)?
t.area:void 0)||{},{marker:_.defaults((null!=(d=this.chartArgs.plotOptions)?null!=(l=d.area)?l.marker:void 0:void 0)||{},{enabled:!1}),shadow:!1}),areaspline:_.defaults((null!=(f=this.chartArgs.plotOptions)?f.areaspline:void 0)||{},{marker:_.defaults((null!=(g=this.chartArgs.plotOptions)?null!=(k=g.areaspline)?k.marker:void 0:void 0)||{},{enabled:!1}),shadow:!1})});return this.chartArgs.xAxis=_.defaults(this.chartArgs.xAxis||{},{type:"datetime"})};c.prototype.keyToDate=function(a){a=""+a.slice(0,
4)+"-"+a.slice(4,6)+"-"+a.slice(6,8);return 1E3*moment(a).unix()};(d=this.Wonkavision).renderers||(d.renderers={});this.Wonkavision.renderers.Highcharts=c}).call(this);
(function(){var d=this.Wonkavision,c=function(a){_.bindAll(this,"render","renderTable","renderColumnHeaders","renderTableData");this.extractArgs(a)};c.prototype.render=function(a){var b,c;this.extractArgs(a);this.pivot="text"===this.viewType?new Wonkavision.PivotTable(this.data,a):new Wonkavision.ChartTable(this.data,a);this.pivot.isFlat&&this.pivot.pivot();this.rows=(null!=(b=this.pivot.rows)?b.members.nonEmpty():void 0)||[];this.columns=(null!=(c=this.pivot.columns)?c.members.nonEmpty():void 0)||
[];return this.element.append("table").attr("class","wv-pivot-table").call(this.renderTable)};c.prototype.extractArgs=function(a){a.data&&(this.data=a.data);a.element&&(this.element=d3.selectAll(a.element));this.viewType=a.viewType||a.view||this.detectViewType(a);"text"!==this.viewType&&(this.renderer=this.createRenderer(a));this.formatLabel=a.formatLabel||function(a){return a};return this.formatData=a.formatData||function(a){return null!=a?a:"-"}};c.prototype.createRenderer=function(a){return new (a.renderer||
Wonkavision.renderers["default"]||Wonkavision.renderers.Rickshaw)(this,a)};c.prototype.memberSpan=function(a){var b;return null!=(b=a.members)?b.nonEmpty().leaves().length:void 0};c.prototype.renderTable=function(a){this.table=a;this.table.call(this.renderColumnHeaders);return this.table.call(this.renderTableData)};c.prototype.renderColumnHeaders=function(a){var b,c=this;if(this.pivot.isFlat&&"rows"===this.pivot.measuresAxis)return b=_.map(this.pivot.axes[0].dimensions,function(a){return a.name}),
b=b.concat(this.pivot.cellset.measureNames),a=a.append("thead"),a=a.append("tr").attr("class","wv-col"),a.selectAll("th.wv-col-header").data(b).enter().append("th").text(function(a){return c.formatLabel(a)});b=this.columns.partitionV();a=a.append("thead");b=a.selectAll("tr.wv-col").data(b).enter().append("tr").attr("class","wv-col");a=this.pivot.rows.dimensions.length+("rows"===this.pivot.measuresAxis?1:0);b.append("th").attr("colspan",a);return b.selectAll("td.wv-col-header").data(function(a){return a},
function(a){return a.key.toString()}).enter().append("th").text(function(a){return c.formatLabel(a.caption)}).attr("colspan",function(a){return c.memberSpan(a)}).attr("class","wv-col-header")};c.prototype.renderTableData=function(a){var b,c,d=this;b=this.rows.partitionH();a=a.append("tbody").selectAll("tr.wv-row").data(b).enter().append("tr").attr("class","wv-row");a.selectAll("th.wv-row-header").data(function(a){return a},function(a){return a.key.toString()}).enter().append("th").text(function(a){return d.formatLabel(a.caption)}).attr("rowspan",
function(a){return d.memberSpan(a)}).attr("class","wv-row-header");c=this;a=a.selectAll("td.wv-cell").data(this.pivot.cellValues).enter().append("td").attr("class","wv-cell");return"text"===this.viewType?a.text(function(a){return d.formatData(a)}):a.each(function(a,b){return c.renderGraph(a,b,this)})};c.prototype.renderGraph=function(a,b,c){b=d3.select(c).append("div").attr("class","wv-chart-container");return this.renderer.renderGraph(a,b)};c.prototype.detectViewType=function(a){return null!=a.seriesSource||
null!=a.seriesFrom?"chart":"text"};d.PivotTableView=c}).call(this);
